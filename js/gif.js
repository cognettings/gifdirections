(function(e){function t(e,n){if({}.hasOwnProperty.call(t.cache,e))return t.cache[e];var r=t.resolve(e);if(!r)throw new Error("Failed to resolve module "+e);var i={id:e,require:t,filename:e,exports:{},loaded:!1,parent:n,children:[]};n&&n.children.push(i);var s=e.slice(0,e.lastIndexOf("/")+1);return t.cache[e]=i.exports,r.call(i.exports,i,i.exports,s,e),i.loaded=!0,t.cache[e]=i.exports}t.modules={},t.cache={},t.resolve=function(e){return{}.hasOwnProperty.call(t.modules,e)?t.modules[e]:void 0},t.define=function(e,n){t.modules[e]=n};var n=function(t){return t="/",{title:"browser",version:"v0.10.26",browser:!0,env:{},argv:[],nextTick:e.setImmediate||function(e){setTimeout(e,0)},cwd:function(){return t},chdir:function(e){t=e}}}();t.define("/gif.coffee",function(e,n,r,i){function s(e,t){return{}.hasOwnProperty.call(e,t)}function o(e,t){for(var n=0,r=t.length;n<r;++n)if(n in t&&t[n]===e)return!0;return!1}function u(e,t){function n(){this.constructor=e}for(var r in t)s(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e}var f,l,c,h,p;c=t("events",e).EventEmitter,f=t("/browser.coffee",e),p=function(e){function t(e){var t,n;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e);for(t in l)n=l[t],null!=this.options[t]?this.options[t]:this.options[t]=n}return u(t,e),l={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null},h={delay:500,copy:!1},t.prototype.setOption=function(e,t){return this.options[e]=t,null!=this._canvas&&(e==="width"||e==="height")?this._canvas[e]=t:void 0},t.prototype.setOptions=function(e){var t,n;return function(r){for(t in e){if(!s(e,t))continue;n=e[t],r.push(this.setOption(t,n))}return r}.call(this,[])},t.prototype.addFrame=function(e,t){var n,r;null==t&&(t={}),n={},n.transparent=this.options.transparent;for(r in h)n[r]=t[r]||h[r];if(null!=this.options.width||this.setOption("width",e.width),null!=this.options.height||this.setOption("height",e.height),"undefined"!==typeof ImageData&&null!=ImageData&&e instanceof ImageData)n.data=e.data;else if("undefined"!==typeof CanvasRenderingContext2D&&null!=CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!==typeof WebGLRenderingContext&&null!=WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?n.data=this.getContextData(e):n.context=e;else if(null!=e.childNodes)t.copy?n.data=this.getImageData(e):n.image=e;else throw new Error("Invalid image");return this.frames.push(n)},t.prototype.render=function(){var e,t;if(this.running)throw new Error("Already running");if(!(null!=this.options.width&&null!=this.options.height))throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(t){for(var n=function(){var e;e=[];for(var t=0;0<=this.frames.length?t<this.frames.length:t>this.frames.length;0<=this.frames.length?++t:--t)e.push(t);return e}.apply(this,arguments),r=0,i=n.length;r<i;++r)e=n[r],t.push(null);return t}.call(this,[]),t=this.spawnWorkers();for(var n=function(){var e;e=[];for(var n=0;0<=t?n<t:n>t;0<=t?++n:--n)e.push(n);return e}.apply(this,arguments),r=0,i=n.length;r<i;++r)e=n[r],this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},t.prototype.abort=function(){var e;while(!0){if(e=this.activeWorkers.shift(),!(null!=e))break;console.log("killing active worker"),e.terminate()}return this.running=!1,this.emit("abort")},t.prototype.spawnWorkers=function(){var e;return e=Math.min(this.options.workers,this.frames.length),function(){var t;t=[];for(var n=this.freeWorkers.length;this.freeWorkers.length<=e?n<e:n>e;this.freeWorkers.length<=e?++n:--n)t.push(n);return t}.apply(this,arguments).forEach(function(e){return function(t){var n;return console.log("spawning worker "+t),n=new Worker(e.options.workerScript),n.onmessage=function(e){return function(t){return e.activeWorkers.splice(e.activeWorkers.indexOf(n),1),e.freeWorkers.push(n),e.frameFinished(t.data)}}(e),e.freeWorkers.push(n)}}(this)),e},t.prototype.frameFinished=function(e){return console.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,o(null,this.imageParts)?this.renderNextFrame():this.finishRendering()},t.prototype.finishRendering=function(){var e,t,n,r,i,s,o;i=0;for(var u=0,a=this.imageParts.length;u<a;++u)t=this.imageParts[u],i+=(t.data.length-1)*t.pageSize+t.cursor;i+=t.pageSize-t.cursor,console.log("rendering finished - filesize "+Math.round(i/1e3)+"kb"),e=new Uint8Array(i),s=0;for(var f=0,l=this.imageParts.length;f<l;++f){t=this.imageParts[f];for(var c=0,h=t.data.length;c<h;++c)o=t.data[c],n=c,e.set(o,s),n===t.data.length-1?s+=t.cursor:s+=t.pageSize}return r=new Blob([e],{type:"image/gif"}),this.emit("finished",r,e)},t.prototype.renderNextFrame=function(){var e,t,n;if(this.freeWorkers.length===0)throw new Error("No free workers");var r=new CustomEvent("progress",{detail:this.finishedFrames/this.frames.length*100});window.dispatchEvent(r);return this.nextFrame>=this.frames.length?void 0:(e=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),t=this.getTask(e),console.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(t))},t.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},t.prototype.getImageData=function(e){var t;return null!=this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),t=this._canvas.getContext("2d"),t.setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},t.prototype.getTask=function(e){var t,n;if(t=this.frames.indexOf(e),n={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,repeat:this.options.repeat,canTransfer:f.name==="chrome"},null!=e.data)n.data=e.data;else if(null!=e.context)n.data=this.getContextData(e.context);else if(null!=e.image)n.data=this.getImageData(e.image);else throw new Error("Invalid frame");return n},t}(c),e.exports=p}),t.define("/browser.coffee",function(e,t,n,r){var i,s,o,u,a;u=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),a=u.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],s=a[1]==="ie"&&document.documentMode,i={name:a[1]==="version"?a[3]:a[1],version:s||parseFloat(a[1]==="opera"&&a[4]?a[4]:a[2]),platform:{name:u.match(/ip(?:ad|od|hone)/)?"ios":(u.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}},i[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,e.exports=i}),t.define("events",function(e,t,r,i){n.EventEmitter||(n.EventEmitter=function(){});var s=t.EventEmitter=n.EventEmitter,o=typeof Array.isArray==="function"?Array.isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},u=10;s.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._events.maxListeners=e},s.prototype.emit=function(e){if(e==="error"&&(!(this._events&&this._events.error)||o(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if(!(typeof t=="function"))if(o(t)){var n=Array.prototype.slice.call(arguments,1),r=t.slice();for(var i=0,s=r.length;i<s;i++)r[i].apply(this,n);return!0}else return!1;switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:var n=Array.prototype.slice.call(arguments,1);t.apply(this,n)}return!0},s.prototype.addListener=function(e,t){if("function"!==typeof t)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",e,t),!this._events[e])this._events[e]=t;else if(o(this._events[e])){if(!this._events[e].warned){var n;this._events.maxListeners!==undefined?n=this._events.maxListeners:n=u,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}this._events[e].push(t)}else this._events[e]=[this._events[e],t];return this},s.prototype.on=s.prototype.addListener,s.prototype.once=function(e,t){var n=this;return n.on(e,function r(){n.removeListener(e,r),t.apply(this,arguments)}),this},s.prototype.removeListener=function(e,t){if("function"!==typeof t)throw new Error("removeListener only takes instances of Function");if(!(this._events&&this._events[e]))return this;var n=this._events[e];if(o(n)){var r=n.indexOf(t);if(r<0)return this;n.splice(r,1),n.length==0&&delete this._events[e]}else this._events[e]===t&&delete this._events[e];return this},s.prototype.removeAllListeners=function(e){return e&&this._events&&this._events[e]&&(this._events[e]=null),this},s.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),o(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]}}),e.GIF=t("/gif.coffee")}).call(this,this)
//# sourceMappingURL=gif.js.map
// gif.js 0.1.6 - https://github.com/jnordberg/gif.js
